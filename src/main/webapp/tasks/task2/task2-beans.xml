<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
	   xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.0.xsd">

	<bean id="scheduler" scope="singleton" lazy-init="false" autowire="no" class="org.springframework.scheduling.quartz.SchedulerFactoryBean">
		<property name="triggers">
		<list>
			<ref bean="simpleTrigger" />
		</list>
		</property>
	</bean>
	<bean id="job" class="org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean">
		<property name="targetObject" ref="task"></property>
		<property name="targetMethod" value="doTask" />
		<property name="concurrent" value="false" /><!-- 作业不并发调度 -->
	</bean>
	<bean id="simpleTrigger" class="org.springframework.scheduling.quartz.SimpleTriggerBean">
		<property name="jobDetail" ref="job" />
		<property name="startDelay" value="0" /><!-- 调度工厂实例化后，经过0秒开始执行调度 -->
		<property name="repeatInterval" value="300000000" /><!-- 每300秒调度一次 -->
	</bean>
	
	
	<bean id="task" scope="singleton" class="com.purang.grab.task.CommonTask">
		<property name="taskName" value="task2"></property>
		<property name="taskDesc" value="中国货币网 债券发行 国债"></property>
		<property name="url" value="http://www.chinamoney.com.cn/fe/jsp/CN/chinamoney/notice/beDraftByTremList.jsp?searchTypeCode=100041"></property>
		<property name="threadCount" value="5"></property>
		<property name="processor" ref="processor"></property>
		<property name="pipelineList">
        	<list>
        		<ref bean="pipeline1" /><!-- 自定义 -->
<!--         		<ref bean="pipeline2" />自定义 -->
        	</list>
		</property>
	</bean>
	
	<bean id="processor" scope="singleton" class="com.purang.grab.pageprocessor.CommonProcessor">
		<property name="site" ref="site"></property>
		<property name="processorList">
        	<list>
        		<ref bean="processor1" /><!-- 自定义 -->
        		<ref bean="processor2" />
        	</list>
		</property>
	</bean>
	<bean id="site" class="com.purang.grab.site.CommonSite">
		<property name="charset" value="UTF-8"></property>
		<property name="sleepTime" value="1000"></property>
		<property name="timeOut" value="50000"></property>
		<property name="useGzip" value="false"></property>
		<property name="headers">
			<map>
				<entry key="Accept-Encoding" value="deflate"/><!--公告来源   中国货币网     -->
			</map>
		</property>
	</bean>
	
	
	<!-- 第一层获取数据 设置继续-->
	<bean id="processor1" class="com.purang.grab.processor.BondAnnounceProcessor1">
<!-- 		<property name="exitRule" ref="ruleExit"></property> -->
		<property name="pageRule" ref="rulePage"></property>
		<property name="fieldRuleList">
        	<list>
        		<ref bean="ruleTitle1" /><!-- 一级标题announceTitle1 -->
        		<ref bean="ruleDate1" />
        	</list>
		</property>
		<property name="urlList">
			<list>
				<ref bean="ruleUrl1" />
			</list>
		</property>
	</bean>
	<bean id="processor2" class="com.purang.grab.processor.BondAnnounceProcessor2">
	</bean>
	
	<!-- 第一层结果处理 导入数据库 -->
	<bean id="pipeline1" class="com.purang.grab.pipeline.BondAnnouncePipeline">
		<property name="className" value="com.purang.grab.entity.BondAnnouncement"></property>
		<property name="defaultValue">
			<map>
				<entry key="announceSource" value="2"/><!--公告来源   中国货币网     -->
				<entry key="announceType1" value="201"/> <!--公告类型：原始披露一级	债券类	201	债券发行 -->
				<entry key="bondType1" value="201"/> <!-- 债券类型:原始披露一级	债券类	201	同业存单 -->
			</map>
		</property>
	
	</bean>
	
	
	<bean id="ruleTitle1" class="com.purang.grab.rule.FieldRule">
		<property name="title" value="标题"></property> 
		<property name="field" value="announceTitle1"></property> 
		<property name="rule" value="/html/body/table/tbody/tr/td/a/text()"></property> 
		<property name="type" value="xpath"></property> 
	</bean>
	<bean id="ruleDate1" class="com.purang.grab.rule.FieldRule">
		<property name="title" value="日期"></property> 
		<property name="field" value="announceDate"></property> 
		<property name="rule" value="/html/body/table/tbody/tr/td[2]/text()"></property> 
		<property name="type" value="xpath"></property> 
	</bean>
	<bean id="ruleUrl1" class="com.purang.grab.rule.FieldRule">
		<property name="name" value="url"></property> 
		<property name="field" value="link1"></property> 
		<property name="rule" value="/html/body/table/tbody/tr/td/a"></property> 
		<property name="type" value="xpath"></property> 
	</bean>
	
	
	
	
	
	
	
	<bean id="rulePage" class="com.purang.grab.rule.PagerRule">
		<property name="title" value="下一页"></property> 
		<property name="field" value="下一页"></property> 
		<property name="rule" value="[title=&quot;下一页&quot;]"></property> 
		<property name="type" value="css"></property> 
	</bean>
	<bean id="ruleExit" class="com.purang.grab.rule.DateExitRule">
		<property name="title" value="退出"></property> 
		<property name="field" value="退出"></property> 
		<property name="dateFormat" value="yyyy-MM-dd"></property> 
		<property name="rule" value="/html/body/table/tbody/tr/td[2]/text()"></property> 
		<property name="type" value="xpath"></property> 
	</bean>
	
</beans>